#include<stdio.h>

/* 
The goal of this executable is to use the format 
string vulnerability to leak the GOT.PLT table. 
Using this, we can calculate the libc base address
(ASLR should be enabled in the kernel) to then
correctly overflow the buffer with the system()
address and /bin/sh address (calculated with the
libc base address + offset).

Assumption is that we have the libc of course.
*/

void main() {
	char format_string[64];
	printf("Hello there.\n");
	printf("Give me a format string: ");
	fflush(stdout);
	fgets(format_string, 63, stdin); format_string[63] = 0;
	printf("You requested the following string to be printed: '%s'\n", format_string);
	printf("Unsafe printing: ");
	printf(format_string);
	printf("\nNow that you know my secrets, do a return-to-libc by smashing this stack: ");
	fflush(stdout);
	char small_buffer[4];
	gets(small_buffer);
	printf("\nGoodbye, I will now leave you to wherever...\n");
	fflush(stdout);
}
